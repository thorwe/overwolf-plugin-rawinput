<html>
	<head>
		<title>Key Capture App Tester</title>
	</head>
	<body>

		<embed id="plugin" type="application/x-key-capture-plugin" width=0px height=0px>
		</embed>

	<h1 id="title"></h1>
	<button id="toggleCapture" width="120" height="60">----</button>
	<hr>
	<div id="messages"></div>

	<script>
		navigator.plugins.refresh(true);

		function addMessage(message) {
			var obj = document.createElement("div");
			obj.innerText = message;
			document.querySelector('#messages').appendChild(obj);
		}

		function plugin() {
			return document.querySelector('#plugin');
		}

		if (plugin() == null) {
			document.querySelector('#title').innerText = "Plugin couldn't be loaded??";
			return;
		} else {
			document.querySelector('#title').innerText = "Plugin was loaded!";
		}

		addMessage("\n");

		window.addEventListener("keypress",
								function(event){
			console.log(event);
		});

		var keyCaptureId = -1,
			button = document.getElementById("toggleCapture");
		
		button.addEventListener("click", function() {
			if (keyCaptureId == -1) {
				plugin().startKeyCapture("1 2 3 4 5 6 7 8 9 0",
										 function(result) {
					keyCaptureId = result;
					addMessage("id: " + keyCaptureId);
					button.innerHTML = "Id: " + keyCaptureId;
				} ,
										 function(result) {
					addMessage(result)
				});

			} else {
				plugin().deleteInstance(keyCaptureId, function(success, id){
					keyCaptureId = -1;
					addMessage("success: " + success + " id: " + id);
					button.innerHTML = "Id: " + keyCaptureId;
				});
			}
		});



	</script>

	</body>
</html>
